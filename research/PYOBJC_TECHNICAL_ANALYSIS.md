# PyObjC æŠ€æœ¯åŸç†ä¸å†…å­˜é£é™©åˆ†æ

> **ç›®çš„**: æ·±å…¥ç†è§£ PyObjC çš„å·¥ä½œæœºåˆ¶ï¼Œè¯†åˆ«å’Œè§„é¿å†…å­˜é£é™©

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šPyObjC æŠ€æœ¯åŸç†

### 1.1 ä»€ä¹ˆæ˜¯ PyObjCï¼Ÿ

**PyObjC** æ˜¯ Python å’Œ Objective-C ä¹‹é—´çš„æ¡¥æ¥åº“ï¼Œå…è®¸ Python ä»£ç è°ƒç”¨ macOS/iOS çš„åŸç”Ÿ APIã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python ä»£ç                                         â”‚
â”‚                                                      â”‚
â”‚  from Quartz import CGEventTapCreate               â”‚
â”‚  tap = CGEventTapCreate(...)                       â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ PyObjC Bridge
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Objective-C Runtime                               â”‚
â”‚                                                      â”‚
â”‚  [CGEventTapCreate æœ¬æœºè°ƒç”¨]                       â”‚
â”‚  NSMachPort å¯¹è±¡                                   â”‚
â”‚  ARC (è‡ªåŠ¨å¼•ç”¨è®¡æ•°)                                 â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ CoreFoundation Framework
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  macOS å†…æ ¸                                         â”‚
â”‚  Event Tap ç³»ç»Ÿè°ƒç”¨                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 1.2 PyObjC çš„å·¥ä½œæœºåˆ¶

#### 1.2.1 ç±»å‹æ˜ å°„

| Python ç±»å‹ | Objective-C ç±»å‹ | CoreFoundation ç±»å‹ |
|------------|-----------------|-------------------|
| `objc.pyobjc_object` | `id` | `CFTypeRef` |
| `str` | `NSString *` | `CFStringRef` |
| `bytes` | `NSData *` | `CFDataRef` |
| `int` | `NSNumber *` | `CFNumberRef` |

#### 1.2.2 è°ƒç”¨æµç¨‹

```python
# Python ä»£ç 
tap = CGEventTapCreate(...)

# PyObjC å†…éƒ¨æµç¨‹
1. è§£æ Python å‡½æ•°è°ƒç”¨
2. è½¬æ¢å‚æ•°ç±»å‹ (Python â†’ ObjC/C)
3. è°ƒç”¨ Objective-C Runtime å‡½æ•°
4. åˆ›å»º Python åŒ…è£…å¯¹è±¡
5. è¿”å›ç»™ Python ä»£ç 
```

#### 1.2.3 å†…å­˜ç®¡ç†è¾¹ç•Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python åƒåœ¾å›æ”¶ (GC)                               â”‚
â”‚  - å¼•ç”¨è®¡æ•°                                         â”‚
â”‚  - å¾ªç¯å¼•ç”¨æ£€æµ‹                                     â”‚
â”‚  âœ“ è‡ªåŠ¨ç®¡ç†                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ PyObjC Bridge
                   â”‚ âš ï¸ éœ€è¦æ‰‹åŠ¨å¹²é¢„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Objective-C ARC                                    â”‚
â”‚  - è‡ªåŠ¨å¼•ç”¨è®¡æ•°                                     â”‚
â”‚  - ç¼–è¯‘æ—¶æ’å…¥ retain/release                       â”‚
â”‚  âœ“ è‡ªåŠ¨ç®¡ç†                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ CoreFoundation C API
                   â”‚ âš ï¸ æ‰‹åŠ¨ç®¡ç†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CoreFoundation å¯¹è±¡                                â”‚
â”‚  - CFRetain / CFRelease                            â”‚
â”‚  - éœ€è¦æ‰‹åŠ¨é…å¯¹                                     â”‚
â”‚  âœ— æ‰‹åŠ¨ç®¡ç†                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®å‘ç°**ï¼š
- âœ… Python å¯¹è±¡ï¼šè‡ªåŠ¨ç®¡ç†
- âœ… Objective-C å¯¹è±¡ï¼šARC è‡ªåŠ¨ç®¡ç†
- âš ï¸ **CoreFoundation å¯¹è±¡ï¼šéœ€è¦æ‰‹åŠ¨ç®¡ç†**

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå†…å­˜é£é™©æ·±åº¦åˆ†æ

### 2.1 ä¸‰ç§å†…å­˜æ¨¡å‹

#### 2.1.1 çº¯ Python å¯¹è±¡ï¼ˆæ— é£é™©ï¼‰

```python
# âœ… å®Œå…¨ç”± Python GC ç®¡ç†
listener = NativeKeyboardListener()
# å½“ Python å¯¹è±¡é”€æ¯æ—¶ï¼Œè‡ªåŠ¨æ¸…ç†
```

#### 2.1.2 çº¯ Objective-C å¯¹è±¡ï¼ˆä½é£é™©ï¼‰

```python
# âœ… ç”± ARC è‡ªåŠ¨ç®¡ç†
from AppKit import NSApplication
app = NSApplication.sharedApplication()
# ARC è‡ªåŠ¨æ’å…¥ retain/release
```

#### 2.1.3 CoreFoundation å¯¹è±¡ï¼ˆé«˜é£é™©ï¼‰

```python
# âš ï¸ éœ€è¦æ‰‹åŠ¨ç®¡ç†
from Quartz import CGEventTapCreate
from CoreFoundation import CFRelease

tap = CGEventTapCreate(...)  # å¼•ç”¨è®¡æ•° = 1
# ... ä½¿ç”¨ tap ...
CFRelease(tap)  # å¼•ç”¨è®¡æ•° = 0ï¼Œå¯¹è±¡è¢«é‡Šæ”¾ âœ…

# å¿˜è®°é‡Šæ”¾ â†’ å†…å­˜æ³„æ¼ âŒ
# é‡å¤é‡Šæ”¾ â†’ å´©æºƒ âŒ
# é‡Šæ”¾æ—¶æœºé”™è¯¯ â†’ å´©æºƒ âŒ
```

---

### 2.2 Toll-Free Bridging çš„é™·é˜±

**ä»€ä¹ˆæ˜¯ Toll-Free Bridgingï¼Ÿ**

CoreFoundation å’Œ Objective-C å¯¹è±¡å¯ä»¥äº’æ¢ï¼Œå› ä¸ºå®ƒä»¬åœ¨è¿è¡Œæ—¶æ˜¯å…¼å®¹çš„ï¼š

```python
# CFStringRef å’Œ NSString * å¯ä»¥äº’æ¢
import CoreFoundation
import Foundation

cf_string = CoreFoundation.CFStringCreateWithCString(...)
objc_string = Foundation.NSString.stringWithString_("test")

# ç†è®ºä¸Šå¯ä»¥äº’ç›¸è½¬æ¢
# ä½†æ‰€æœ‰æƒå½’å±ä¸åŒï¼
```

**é£é™©åœºæ™¯**ï¼š

```python
# åœºæ™¯ 1: æ··æ·†å¯¹è±¡ç±»å‹
tap = CGEventTapCreate(...)  # è¿”å› CFTypeRef (å®é™…ä¸Šæ˜¯ NSMachPort)

# é”™è¯¯å‡è®¾ï¼šè®¤ä¸ºè¿™æ˜¯ ObjC å¯¹è±¡ï¼Œä¸éœ€è¦é‡Šæ”¾
# âŒ å®é™…ä¸Šæ˜¯ CF å¯¹è±¡ï¼Œéœ€è¦ CFRelease

# åœºæ™¯ 2: é‡Šæ”¾é¡ºåºé”™è¯¯
loop_source = CFMachPortCreateRunLoopSource(...)
CFRunLoopAddSource(loop, loop_source, ...)
CFRunLoopRun()  # Run Loop æ­£åœ¨ä½¿ç”¨ source
# âŒ æ­¤æ—¶ä¸èƒ½é‡Šæ”¾ sourceï¼
CFRelease(loop_source)  # å´©æºƒï¼
```

---

### 2.3 æˆ‘é‡åˆ°çš„å´©æºƒåŸå› åˆ†æ

**å´©æºƒå †æ ˆ**ï¼š
```
CFRunLoopSourceInvalidate
__CFMachPortDeallocate
_CFRelease
```

**æ ¹æœ¬åŸå› **ï¼š

```python
def _cleanup_resources(self):
    # âŒ é”™è¯¯ä»£ç 
    if self._loop_source is not None:
        CFRelease(self._loop_source)  # ç›´æ¥é‡Šæ”¾ï¼Œä½†æœªä» Run Loop ç§»é™¤
```

**é—®é¢˜**ï¼š
1. `loop_source` ä»ç„¶è¢« `run_loop` æŒæœ‰
2. ç›´æ¥è°ƒç”¨ `CFRelease` å¯¼è‡´ `run_loop` è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜
3. è§¦å‘ `EXC_BREAKPOINT` å´©æºƒ

**æ­£ç¡®åšæ³•**ï¼š

```python
def _cleanup_resources(self):
    # âœ… æ­£ç¡®ä»£ç 
    if self._loop_source is not None and self._loop is not None:
        # 1. å…ˆä» Run Loop ç§»é™¤
        CFRunLoopRemoveSource(self._loop, self._loop_source, ...)

        # 2. å†é‡Šæ”¾
        CFRelease(self._loop_source)
```

---

### 2.4 Run Loop çš„ç”Ÿå‘½å‘¨æœŸçº¦æŸ

**å…³é”®çº¦æŸ**ï¼š

```
CFRunLoopAddSource(loop, source, mode)
    â”‚
    â–¼
CFRunLoopRun()  â† Run Loop æ´»è·ƒæœŸ
    â”‚              - source è¢«å¼•ç”¨
    â”‚              - ä¸èƒ½é‡Šæ”¾ sourceï¼
    â”‚
    â–¼
CFRunLoopStop()  â† Run Loop åœæ­¢
    â”‚
    â–¼
CFRunLoopRemoveSource()  â† ç°åœ¨å¯ä»¥ç§»é™¤
CFRelease()              â† ç°åœ¨å¯ä»¥é‡Šæ”¾
```

**é£é™©æ—¶é—´çº¿**ï¼š

| é˜¶æ®µ | å¯æ‰§è¡Œæ“ä½œ | ç¦æ­¢æ“ä½œ |
|------|-----------|---------|
| åˆ›å»ºå | `CFRunLoopAddSource` | - |
| è¿è¡Œä¸­ | - | `CFRelease` âŒ |
| åœæ­¢å | `CFRunLoopRemoveSource`, `CFRelease` | - |

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šä¸ pynput çš„å¯¹æ¯”

### 3.1 å†…å­˜ç®¡ç†å¯¹æ¯”

| ç»´åº¦ | pynput | PyObjC åŸç”Ÿ |
|------|--------|-------------|
| **å¯¹è±¡ç±»å‹è¯†åˆ«** | éšå¼ | æ˜¾å¼ |
| **å†…å­˜ç®¡ç†** | âŒ ä¸é‡Šæ”¾ï¼ˆæ³„æ¼ï¼‰ | âš ï¸ éœ€æ‰‹åŠ¨é‡Šæ”¾ |
| **é£é™©ç±»å‹** | å†…å­˜æ³„æ¼ | å´©æºƒ/æ³„æ¼ |
| **è°ƒè¯•éš¾åº¦** | å›°éš¾ | ä¸­ç­‰ |

### 3.2 pynput çš„å†…å­˜æ³„æ¼

```python
# pynput/_util/darwin.py:250
finally:
    self._loop = None  # åªæ¸…ç©ºå¼•ç”¨ï¼Œä¸é‡Šæ”¾èµ„æº
```

**ç»“æœ**ï¼š
- æ¯æ¬¡ listener é‡å¯æ³„æ¼ ~6.5KB
- 100 æ¬¡é‡å¯ = 650KB
- 1000 æ¬¡é‡å¯ = 6.5MB

**ä¼˜ç‚¹**ï¼š
- ä¸ä¼šå´©æºƒï¼ˆç›¸å¯¹ç¨³å®šï¼‰
- æ³„æ¼é€Ÿåº¦è¾ƒæ…¢

**ç¼ºç‚¹**ï¼š
- é•¿æœŸè¿è¡Œç´¯ç§¯æ³„æ¼
- æ— æ³•ä¸»åŠ¨æ§åˆ¶èµ„æºé‡Šæ”¾

---

### 3.3 PyObjC çš„åŒåˆƒå‰‘

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œå…¨æŒæ§èµ„æºç”Ÿå‘½å‘¨æœŸ
- âœ… å¯ä»¥å®ç°æ— æ³„æ¼
- âœ… æ€§èƒ½æ›´å¥½ï¼ˆå¯åŠ¨å¿« 93%ï¼‰

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦æ·±å…¥ç†è§£ CoreFoundation API
- âš ï¸ é‡Šæ”¾æ—¶æœºé”™è¯¯ä¼šå´©æºƒ
- âš ï¸ è°ƒè¯•å›°éš¾ï¼ˆåº•å±‚å´©æºƒï¼‰

---

## ç¬¬å››éƒ¨åˆ†ï¼šå†…å­˜é£é™©ç¼“è§£ç­–ç•¥

### 4.1 é˜²å¾¡æ€§ç¼–ç¨‹

#### ç­–ç•¥ 1: ä½¿ç”¨ Python çš„å¼±å¼•ç”¨

```python
import weakref

class NativeKeyboardListener:
    def __init__(self):
        self._tap_ref = None  # å¼±å¼•ç”¨

    def start(self):
        tap = CGEventTapCreate(...)
        # åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
        self._tap_ref = weakref.ref(tap)
```

#### ç­–ç•¥ 2: å»¶è¿Ÿé‡Šæ”¾

```python
def stop(self):
    CFRunLoopStop(self._loop)
    # ç­‰å¾… Run Loop å®Œå…¨åœæ­¢
    time.sleep(0.1)
    # å†é‡Šæ”¾èµ„æº
    self._cleanup_resources()
```

#### ç­–ç•¥ 3: ä½¿ç”¨ autoreleasepool

```python
import objc

def with_autoreleasepool(func):
    def wrapper(*args, **kwargs):
        objc.autorelease_pool()
        try:
            return func(*args, **kwargs)
        finally:
            objc.drpool()
    return wrapper

@with_autoreleasepool
def create_tap():
    return CGEventTapCreate(...)
```

---

### 4.2 æœ€ä½³å®è·µ

#### è§„åˆ™ 1: æ˜ç¡®å¯¹è±¡æ‰€æœ‰æƒ

```python
# âœ… å¥½çš„åšæ³•
def create_event_tap(self):
    """åˆ›å»º Event Tapï¼Œè°ƒç”¨è€…è´Ÿè´£é‡Šæ”¾"""
    tap = CGEventTapCreate(...)
    return tap

def release_event_tap(self, tap):
    """é‡Šæ”¾ Event Tap"""
    if tap:
        CFRelease(tap)
```

#### è§„åˆ™ 2: ä½¿ç”¨ RAII æ¨¡å¼

```python
class CFObjectGuard:
    """RAII é£æ ¼çš„ CF å¯¹è±¡ç®¡ç†"""
    def __init__(self, obj):
        self._obj = obj

    def __del__(self):
        if self._obj:
            CFRelease(self._obj)

    def get(self):
        return self._obj

# ä½¿ç”¨
guard = CFObjectGuard(CGEventTapCreate(...))
tap = guard.get()
# è‡ªåŠ¨é‡Šæ”¾
```

#### è§„åˆ™ 3: åˆ†é˜¶æ®µæ¸…ç†

```python
def cleanup(self):
    """åˆ†é˜¶æ®µæ¸…ç†ï¼Œé¿å…å´©æºƒ"""
    # é˜¶æ®µ 1: åœæ­¢ Run Loop
    if self._loop:
        CFRunLoopStop(self._loop)
        self._loop = None

    # é˜¶æ®µ 2: ç­‰å¾…åœæ­¢å®Œæˆ
    time.sleep(0.05)

    # é˜¶æ®µ 3: ç§»é™¤ Source
    if self._loop_source:
        try:
            CFRunLoopRemoveSource(...)
        except:
            pass  # å¯èƒ½å·²ç»æ— æ•ˆ
        finally:
            self._loop_source = None

    # é˜¶æ®µ 4: é‡Šæ”¾ Tap
    if self._tap:
        try:
            CFRelease(self._tap)
        except:
            pass  # å¯èƒ½å·²ç»é‡Šæ”¾
        finally:
            self._tap = None
```

---

### 4.3 æµ‹è¯•ç­–ç•¥

#### å†…å­˜æ³„æ¼æµ‹è¯•

```python
import gc
import tracemalloc

def test_memory_leak():
    """æµ‹è¯•å†…å­˜æ³„æ¼"""
    # å»ºç«‹åŸºçº¿
    gc.collect()
    snapshot1 = tracemalloc.take_snapshot()

    # å¤šæ¬¡åˆ›å»ºå’Œé”€æ¯
    for i in range(100):
        listener = NativeKeyboardListener()
        listener.start()
        listener.stop()

    # å¼ºåˆ¶ GC
    gc.collect()
    snapshot2 = tracemalloc.take_snapshot()

    # æ¯”è¾ƒå·®å¼‚
    top_stats = snapshot2.compare_to(snapshot1, 'lineno')
    for stat in top_stats[:10]:
        print(stat)
```

#### å‹åŠ›æµ‹è¯•

```python
def test_stress():
    """å‹åŠ›æµ‹è¯•ï¼šå¿«é€Ÿé‡å¯"""
    for i in range(1000):
        listener = NativeKeyboardListener()
        if not listener.start():
            print(f"ç¬¬ {i} æ¬¡å¯åŠ¨å¤±è´¥")
            break
        listener.stop()
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šæ€»ç»“ä¸å»ºè®®

### 5.1 PyObjC æŠ€æœ¯åŸç†æ€»ç»“

1. **æ¡¥æ¥æœºåˆ¶**: Python â†” Objective-C â†” CoreFoundation
2. **å†…å­˜ç®¡ç†**: ä¸‰å±‚æ¨¡å‹ï¼ˆPython GC / ARC / æ‰‹åŠ¨ï¼‰
3. **å…³é”®é£é™©**: CoreFoundation å¯¹è±¡çš„æ‰‹åŠ¨ç®¡ç†

### 5.2 å†…å­˜é£é™©æ€»ç»“

| é£é™©ç±»å‹ | ä¸¥é‡æ€§ | å‘ç”Ÿæ¦‚ç‡ | å½±å“ |
|---------|--------|---------|------|
| å†…å­˜æ³„æ¼ | ğŸŸ¡ ä¸­ | é«˜ | é•¿æœŸè¿è¡Œé—®é¢˜ |
| é‡Šæ”¾å´©æºƒ | ğŸ”´ é«˜ | ä¸­ | ç«‹å³å´©æºƒ |
| Toll-Free Bridging æ··æ·† | ğŸŸ¡ ä¸­ | ä½ | éš¾ä»¥è°ƒè¯• |
| Run Loop ç«æ€ | ğŸ”´ é«˜ | ä¸­ | å´©æºƒ |

### 5.3 å®æ–½å»ºè®®

#### çŸ­æœŸæ–¹æ¡ˆï¼ˆæ¨èï¼‰

1. **ä¿ç•™ pynput**
   - è™½ç„¶æœ‰å†…å­˜æ³„æ¼ï¼Œä½†ç›¸å¯¹ç¨³å®š
   - æ³„æ¼é€Ÿåº¦å¯æ§ï¼ˆæ¯å°æ—¶ ~1MBï¼‰

2. **ä¼˜åŒ– pynput é‡å¯ç­–ç•¥**
   - å‡å°‘é‡å¯é¢‘ç‡ï¼ˆwatchdog 60s â†’ 120sï¼‰
   - æ·»åŠ é‡å¯å†·å´æœŸï¼ˆè‡³å°‘ 30sï¼‰

#### é•¿æœŸæ–¹æ¡ˆï¼ˆéœ€è¦å……åˆ†æµ‹è¯•ï¼‰

1. **é‡‡ç”¨ PyObjC åŸç”Ÿå®ç°**
   - æ€§èƒ½ä¼˜åŠ¿æ˜æ˜¾ï¼ˆå¯åŠ¨å¿« 93%ï¼‰
   - éœ€è¦å®Œå–„çš„èµ„æºç®¡ç†
   - å»ºè®®åˆ†é˜¶æ®µè¿ç§»

2. **å®æ–½å‰æ**
   - âœ… å®Œå–„çš„å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–å†…å­˜ç®¡ç†ï¼‰
   - âœ… é›†æˆå†…å­˜æ³„æ¼æ£€æµ‹
   - âœ… ç°åº¦å‘å¸ƒï¼ˆä»å°èŒƒå›´å¼€å§‹ï¼‰
   - âœ… ä¿ç•™ pynput ä½œä¸º fallback

---

### 5.4 æœ€ç»ˆç»“è®º

**PyObjC æŠ€æœ¯åŸç†**ï¼š
- âœ… æˆç†Ÿç¨³å®šï¼Œè¢«å¹¿æ³›åº”ç”¨
- âœ… æ€§èƒ½ä¼˜å¼‚
- âš ï¸ éœ€è¦æ·±å…¥ç†è§£å†…å­˜ç®¡ç†

**å†…å­˜é£é™©**ï¼š
- âš ï¸ CoreFoundation å¯¹è±¡éœ€è¦æ‰‹åŠ¨ç®¡ç†
- âš ï¸ é‡Šæ”¾æ—¶æœºé”™è¯¯ä¼šå¯¼è‡´å´©æºƒ
- âœ… å¯ä»¥é€šè¿‡é˜²å¾¡æ€§ç¼–ç¨‹è§„é¿

**å®æ–½å»ºè®®**ï¼š
- ğŸŸ¡ **è°¨æ…å®æ–½**ï¼Œéœ€è¦å……åˆ†æµ‹è¯•
- ğŸŸ¡ **ä¼˜å…ˆä¿®å¤ pynput æ³„æ¼**ï¼ˆçŸ­æœŸï¼‰
- ğŸŸ¢ **é•¿æœŸè¿ç§»åˆ° PyObjC**ï¼ˆéœ€å‡†å¤‡ï¼‰

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-07
**ä½œè€…**: Claude (Technical Analysis)
