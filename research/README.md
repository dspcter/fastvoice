# PyObjC 原生实现研究

> **状态**: 原型验证阶段，未集成到主应用
>
> **目的**: 探索替换 pynput 的可行性，解决 TSM 线程安全问题

---

## 📁 文件说明

| 文件 | 说明 |
|------|------|
| `PYOBJC_NATIVE_RESEARCH.md` | 完整技术调研文档 |
| `native_keyboard_listener.py` | PyObjC 原型实现 |
| `test_native_listener.py` | 单元测试 |

---

## ⚠️ 重要说明

1. **这些文件未集成到主应用**
   - 主应用 (`main.py`) 仍在使用 pynput
   - 修改这些文件**不会**影响主应用

2. **原型状态**
   - 实现了基础键盘监听功能
   - 存在资源清理 bug（已识别）
   - 仅用于技术可行性验证

3. **测试方法**
   ```bash
   cd research
   python3 test_native_listener.py
   ```

---

## 📊 初步成果

| 指标 | pynput | PyObjC 原型 | 改进 |
|------|--------|-------------|------|
| 启动时间 | 508ms | 34ms | ✅ -93% |
| 内存占用 | 8-12MB | ~2-3MB | ✅ -70% |
| TSM 线程安全 | ❌ 问题 | ✅ 解决 | ✅ 修复 |

---

## 🚧 已知问题

1. **资源清理 bug**
   - `CFRelease` 调用顺序不当
   - 需要先调用 `CFRunLoopRemoveSource`
   - 已在代码中标注修复方案

2. **功能不完整**
   - 缺少双击+长按支持
   - 缺少状态机集成
   - 缺少按键去抖

---

## 📋 下一步（如需继续开发）

1. 修复资源清理 bug
2. 实现完整功能（状态机、双击+长按等）
3. 与 HotkeyManager 集成
4. 全面测试

---

## 🔗 相关文档

- [技术调研文档](PYOBJC_NATIVE_RESEARCH.md)
- [主应用 README](../README.md)

---

**创建日期**: 2026-01-07
**最后更新**: 2026-01-07
