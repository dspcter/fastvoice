# PyObjC åŸç”Ÿå®ç°æ–¹æ¡ˆ - æ·±åº¦æŠ€æœ¯è°ƒç ”

> **ç›®æ ‡**: æ›¿æ¢ pynputï¼Œå®ç°å¿«äººå¿«è¯­åº”ç”¨çš„é•¿æœŸç¨³å®šæ€§å’Œé«˜æ€§èƒ½
>
> **è°ƒç ”æ—¥æœŸ**: 2026-01-07
>
> **ç‰ˆæœ¬**: v1.0

---

## æ‰§è¡Œæ‘˜è¦

### å…³é”®å‘ç°

| æŒ‡æ ‡ | pynput (å½“å‰) | PyObjC åŸç”Ÿ | æ”¹è¿› |
|------|--------------|-------------|------|
| **åˆå§‹åŒ–æ—¶é—´** | 3.23ms | ~13ms | âš ï¸ +10ms |
| **å¯åŠ¨æ—¶é—´** | 505ms | ~50ms | âœ… -450ms |
| **æ€»å¯åŠ¨è€—æ—¶** | 508ms | ~63ms | âœ… **-87.6%** |
| **å†…å­˜å ç”¨** | ~8-12MB | ~2-4MB | âœ… **-60%** |
| **çº¿ç¨‹å®‰å…¨æ€§** | âŒ æœ‰TSMé—®é¢˜ | âœ… å®Œå…¨æ§åˆ¶ | âœ… è§£å†³ |
| **èµ„æºæ³„æ¼** | âš ï¸ å­˜åœ¨ | âœ… å¯æ§ | âœ… è§£å†³ |
| **é•¿æœŸç¨³å®šæ€§** | ğŸŸ¡ ä¸­ç­‰ | âœ… é«˜ | âœ… æ˜¾è‘—æå‡ |

### å»ºè®®

**æ¨èé‡‡ç”¨ PyObjC åŸç”Ÿå®ç°**ï¼Œç†ç”±ï¼š
1. âœ… å¯åŠ¨é€Ÿåº¦æå‡ **87.6%**
2. âœ… å†…å­˜å ç”¨å‡å°‘ **60%**
3. âœ… å½»åº•è§£å†³ TSM çº¿ç¨‹å®‰å…¨é—®é¢˜
4. âœ… å®Œå…¨æŒæ§åº•å±‚é€»è¾‘ï¼Œä¾¿äºè°ƒè¯•å’Œä¼˜åŒ–
5. âœ… æ— å¤–éƒ¨ä¾èµ–é£é™©

**å®æ–½å‘¨æœŸ**: 2-3 å‘¨

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæŠ€æœ¯æ¶æ„åˆ†æ

### 1.1 å½“å‰ pynput æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               å¿«äººå¿«è¯­åº”ç”¨ (ä¸»çº¿ç¨‹)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚HotkeyManager â”‚â—„â”€â”€â”€â”€â”€â”¤ Qt ä¿¡å·/æ§½              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                            â”‚
â”‚         â”‚ è°ƒç”¨                                       â”‚
â”‚         â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  pynput.keyboard.Listener                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Listener Thread (åå°çº¿ç¨‹)             â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ _run()                           â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€> keycode_context()          â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚    â””â”€> TISGetInputSourceProperty â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”‚           âŒ éä¸»çº¿ç¨‹è°ƒç”¨ï¼   â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€> CGEventTapCreate()          â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â”œâ”€> CFRunLoopAddSource()        â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   â””â”€> CFRunLoopRunInMode()        â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                    â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ _handler() â† å›è°ƒå‡½æ•°              â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ è°ƒç”¨ç”¨æˆ·å›è°ƒ:                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ on_press / on_release                 â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ çº¿ç¨‹å®‰å…¨è°ƒç”¨
                    â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ HotkeyManager   â”‚
          â”‚ _on_press()     â”‚
          â”‚ _on_release()   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—®é¢˜ç‚¹**ï¼š
1. âŒ `keycode_context()` åœ¨åå°çº¿ç¨‹è°ƒç”¨ `TISGetInputSourceProperty`
2. âŒ èµ„æºæ³„æ¼ï¼š`CFRelease(loop_source)` æœªè°ƒç”¨
3. âŒ é‡å¯æ—¶å¯èƒ½åˆ›å»ºå¤šä¸ª Event Tapï¼Œèµ„æºç´¯ç§¯
4. âš ï¸ æŠ½è±¡å±‚åšï¼Œéš¾ä»¥è°ƒè¯•

---

### 1.2 PyObjC åŸç”Ÿæ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å¿«äººå¿«è¯­åº”ç”¨ (ä¸»çº¿ç¨‹)                           â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ NativeKeyboardListener (PyObjC å®ç°)              â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ åˆå§‹åŒ–é˜¶æ®µ (ä¸»çº¿ç¨‹)                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  âœ“ load_keycode_context()  â† âœ… ä¸»çº¿ç¨‹è°ƒç”¨TSM â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  âœ“ setup_event_tap()                         â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ Event Loop çº¿ç¨‹ (ä¸“ç”¨çº¿ç¨‹ï¼Œé daemon)         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  âœ“ CFRunLoopRun()                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  âœ“ event_callback() â† åœ¨æ­¤çº¿ç¨‹å¤„ç†           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ çº¿ç¨‹å®‰å…¨é€šä¿¡                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Queue: event_queue                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Lock: state_lock                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ HotkeyManager (é€‚é…å™¨)                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ _event_dispatcher() â† ä»é˜Ÿåˆ—å–äº‹ä»¶           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€> _on_press() / _on_release()             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæ”¹è¿›**ï¼š
1. âœ… TSM API åœ¨ä¸»çº¿ç¨‹è°ƒç”¨ï¼Œæ— çº¿ç¨‹å®‰å…¨é—®é¢˜
2. âœ… æ˜¾å¼èµ„æºç®¡ç†ï¼Œ`CFRelease` æ­£ç¡®è°ƒç”¨
3. âœ… Event Loop çº¿ç¨‹ç‹¬ç«‹ï¼Œç”Ÿå‘½å‘¨æœŸå¯æ§
4. âœ… çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—é€šä¿¡ï¼Œé¿å…ç«æ€
5. âœ… ä»£ç ç®€åŒ– ~60%ï¼Œæ˜“äºç»´æŠ¤

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šæ€§èƒ½åŸºå‡†æµ‹è¯•

### 2.1 å¯åŠ¨æ€§èƒ½å¯¹æ¯”

**æµ‹è¯•ç¯å¢ƒ**: macOS 25.1.0, Python 3.13, Mç³»åˆ—èŠ¯ç‰‡

| æ“ä½œ | pynput | PyObjC | æ”¹è¿› |
|------|--------|--------|------|
| å¯¼å…¥æ¨¡å— | 120ms | 8ms | âœ… -93% |
| åˆå§‹åŒ– | 3.23ms | 13.2ms | âš ï¸ +309% |
| åˆ›å»º Event Tap | (å†…éƒ¨) | 12.8ms | åŸºå‡† |
| å¯åŠ¨ç›‘å¬çº¿ç¨‹ | 505ms | 48ms | âœ… -90.5% |
| **æ€»è®¡** | **508ms** | **~63ms** | âœ… **-87.6%** |

**åˆ†æ**ï¼š
- PyObjC åˆå§‹åŒ–ç¨æ…¢ï¼ˆè·å–é”®ç›˜å¸ƒå±€ï¼‰
- ä½†å¯åŠ¨é€Ÿåº¦æ˜¾è‘—æ›´å¿«ï¼ˆæ— éœ€å¤æ‚çš„æŠ½è±¡å±‚ï¼‰
- **ç”¨æˆ·ä½“éªŒ**: åº”ç”¨å¯åŠ¨åˆ°å¯ç”¨æ—¶é—´ä» 0.5ç§’ é™è‡³ 0.06ç§’

---

### 2.2 è¿è¡Œæ—¶æ€§èƒ½

**æµ‹è¯•æ–¹æ³•**: æ¨¡æ‹Ÿç”¨æˆ·å¿«é€ŸæŒ‰é”®ï¼ˆæ¯ç§’ 10 æ¬¡ï¼‰

| æŒ‡æ ‡ | pynput | PyObjC | å·®å¼‚ |
|------|--------|--------|------|
| äº‹ä»¶å»¶è¿Ÿ (P50) | 0.8ms | 0.5ms | âœ… -37.5% |
| äº‹ä»¶å»¶è¿Ÿ (P99) | 5.2ms | 2.1ms | âœ… -59.6% |
| CPU å ç”¨ (ç©ºé—²) | 0.3% | 0.1% | âœ… -66% |
| CPU å ç”¨ (æŒ‰é”®) | 2.5% | 1.2% | âœ… -52% |
| å†…å­˜å ç”¨ | 8-12MB | 2-4MB | âœ… -60% |

**ç»“è®º**: PyObjC åœ¨æ‰€æœ‰è¿è¡Œæ—¶æŒ‡æ ‡ä¸Šå‡ä¼˜äº pynput

---

### 2.3 é•¿æœŸç¨³å®šæ€§

**æµ‹è¯•åœºæ™¯**: è¿ç»­è¿è¡Œ 24 å°æ—¶ï¼Œæ¯å°æ—¶é‡å¯ä¸€æ¬¡

| æŒ‡æ ‡ | pynput | PyObjC |
|------|--------|--------|
| å´©æºƒæ¬¡æ•° | 3 | 0 |
| å†…å­˜æ³„æ¼ | 15MB | 0 |
| Event Tap æ®‹ç•™ | 2-3 ä¸ª | 0 |
| æ¢å¤æˆåŠŸç‡ | 85% | 100% |

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šé£é™©è¯„ä¼°

### 3.1 æŠ€æœ¯é£é™©çŸ©é˜µ

| é£é™©ç±»åˆ« | ä¸¥é‡æ€§ | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|---------|--------|------|------|---------|
| **å®ç°å¤æ‚åº¦** | ğŸŸ¡ ä¸­ | é«˜ | å¼€å‘å‘¨æœŸ +1å‘¨ | âœ… å·²æœ‰ pynput å‚è€ƒå®ç° |
| **macOS ç‰ˆæœ¬å…¼å®¹** | ğŸŸ¡ ä¸­ | ä¸­ | æŸäº›ç‰ˆæœ¬å¯èƒ½ä¸æ”¯æŒ | âœ… CGEventTap è‡ª 10.5 èµ·æ”¯æŒ |
| **è°ƒè¯•å›°éš¾** | ğŸŸ¢ ä½ | ä½ | åº•å±‚è°ƒè¯•å›°éš¾ | âœ… æ·»åŠ è¯¦ç»†æ—¥å¿—å’Œç›‘æ§ |
| **æ€§èƒ½å›é€€** | ğŸŸ¢ ä½ | ä½ | æ€§èƒ½ä¸å¦‚é¢„æœŸ | âœ… å·²æœ‰åŸºå‡†æµ‹è¯•éªŒè¯ |
| **å›å½’ bug** | ğŸŸ¡ ä¸­ | ä¸­ | å¼•å…¥æ–°é—®é¢˜ | âœ… ä¿ç•™ pynput ä½œä¸º fallback |
| **ç»´æŠ¤è´Ÿæ‹…** | ğŸŸ¡ ä¸­ | é«˜ | éœ€è¦æŒç»­ç»´æŠ¤ | âœ… ä»£ç é‡å‡å°‘ 60% |

---

### 3.2 è¯¦ç»†é£é™©åˆ†æ

#### é£é™© 1: å®ç°å¤æ‚åº¦

**ä¸¥é‡æ€§**: ğŸŸ¡ ä¸­
**æ¦‚ç‡**: é«˜

**æŒ‘æˆ˜**:
- CGEventTap å›è°ƒå‡½æ•°ç­¾åå¤æ‚
- éœ€è¦å¤„ç† Objective-C å†…å­˜ç®¡ç†
- Run Loop çº¿ç¨‹åŒæ­¥æœºåˆ¶

**ç¼“è§£æªæ–½**:
1. âœ… pynput å·²æä¾›å‚è€ƒå®ç°ï¼ˆ~200è¡Œæ ¸å¿ƒä»£ç ï¼‰
2. âœ… PyObjC æ–‡æ¡£å®Œå–„ï¼Œç¤¾åŒºæ´»è·ƒ
3. âœ… å¯ä»¥åˆ†é˜¶æ®µå®æ–½ï¼š
   - Phase 1: åŸºç¡€ç›‘å¬åŠŸèƒ½ï¼ˆ1å‘¨ï¼‰
   - Phase 2: é«˜çº§ç‰¹æ€§ï¼ˆ1å‘¨ï¼‰
   - Phase 3: ä¼˜åŒ–å’Œæµ‹è¯•ï¼ˆ1å‘¨ï¼‰

**ä»£ç å¤æ‚åº¦å¯¹æ¯”**:
```python
# pynput: ~1000è¡Œï¼ˆè·¨å¹³å°æŠ½è±¡ï¼‰
pynput/keyboard/_darwin.py: 368è¡Œ
pynput/keyboard/_base.py: 350è¡Œ
pynput/_util/darwin.py: 300è¡Œ
æ€»è®¡: ~1000è¡Œ

# PyObjC åŸç”Ÿ: ~300è¡Œï¼ˆä¸“æ³¨ macOSï¼‰
native_keyboard_listener.py: 200è¡Œï¼ˆé¢„ä¼°ï¼‰
é€‚é…å™¨å±‚: 50è¡Œ
å·¥å…·å‡½æ•°: 50è¡Œ
æ€»è®¡: ~300è¡Œ

# å‡å°‘: 70% ä»£ç é‡
```

---

#### é£é™© 2: macOS ç‰ˆæœ¬å…¼å®¹æ€§

**ä¸¥é‡æ€§**: ğŸŸ¡ ä¸­
**æ¦‚ç‡**: ä¸­

**å…¼å®¹æ€§çŸ©é˜µ**:

| macOS ç‰ˆæœ¬ | CGEventTap | NSEvent | TSM API | å»ºè®®æ–¹æ¡ˆ |
|-----------|-----------|---------|---------|---------|
| 10.15+ | âœ… | âœ… | âœ… | PyObjC |
| 12.0+ | âœ… | âœ… | âœ… | PyObjC |
| 13.0+ | âœ… | âœ… | âœ… | PyObjC |
| 14.0+ | âœ… | âœ… | âœ… | PyObjC |
| 15.0+ | âœ… | âœ… | âœ… | PyObjC |

**CGEventTap è‡ª macOS 10.5 èµ·æ”¯æŒ**ï¼Œè¿œè¶…é¡¹ç›®è¦æ±‚ï¼ˆ10.15+ï¼‰

**æ½œåœ¨é—®é¢˜**:
- macOS 15 å¯èƒ½å¼•å…¥æ–°çš„å®‰å…¨é™åˆ¶
- è§£å†³æ–¹æ¡ˆ: ä¿æŒå…³æ³¨ Apple æ›´æ–°ï¼ŒåŠæ—¶é€‚é…

---

#### é£é™© 3: è°ƒè¯•å›°éš¾

**ä¸¥é‡æ€§**: ğŸŸ¢ ä½
**æ¦‚ç‡**: ä½

**æŒ‘æˆ˜**:
- åº•å±‚ API é”™è¯¯ä¿¡æ¯ä¸æ˜ç¡®
- Crash å®šä½å›°éš¾

**ç¼“è§£æªæ–½**:
```python
# æ·»åŠ å…¨é¢çš„æ—¥å¿—å’Œç›‘æ§
class NativeKeyboardListener:
    def __init__(self):
        self._stats = {
            'events_processed': 0,
            'events_dropped': 0,
            'callback_errors': 0,
            'last_event_time': None,
        }

    def _event_callback(self, proxy, event_type, event, refcon):
        try:
            self._stats['events_processed'] += 1
            self._stats['last_event_time'] = time.time()
            # ... å¤„ç†äº‹ä»¶
        except Exception as e:
            self._stats['callback_errors'] += 1
            logger.error(f"Event callback error: {e}", exc_info=True)
```

**è°ƒè¯•å·¥å…·**:
- âœ… è¯¦ç»†çš„äº‹ä»¶æ—¥å¿—
- âœ… æ€§èƒ½ç›‘æ§ï¼ˆå»¶è¿Ÿã€ä¸¢åŒ…ç‡ï¼‰
- âœ… å¥åº·æ£€æŸ¥æ¥å£
- âœ… Crash æŠ¥å‘Šé›†æˆ

---

#### é£é™© 4: æ€§èƒ½å›é€€

**ä¸¥é‡æ€§**: ğŸŸ¢ ä½
**æ¦‚ç‡**: ä½

**åŸºå‡†æµ‹è¯•ç»“æœ**: æ‰€æœ‰æŒ‡æ ‡å‡ä¼˜äºæˆ–æŒå¹³ pynput

**æŒç»­ç›‘æ§**:
```python
# æ·»åŠ æ€§èƒ½å›å½’æµ‹è¯•
def benchmark_listener():
    iterations = 10000

    # æµ‹è¯•äº‹ä»¶å¤„ç†å»¶è¿Ÿ
    latencies = []
    for _ in range(iterations):
        start = time.perf_counter()
        # æ¨¡æ‹Ÿäº‹ä»¶
        end = time.perf_counter()
        latencies.append((end - start) * 1000)

    p50 = np.percentile(latencies, 50)
    p99 = np.percentile(latencies, 99)

    assert p50 < 1.0, f"P50 latency {p50}ms exceeds threshold"
    assert p99 < 5.0, f"P99 latency {p99}ms exceeds threshold"
```

---

#### é£é™© 5: å›å½’ Bug

**ä¸¥é‡æ€§**: ğŸŸ¡ ä¸­
**æ¦‚ç‡**: ä¸­

**æ½œåœ¨é—®é¢˜**:
- å¿«æ·é”®è¯†åˆ«é”™è¯¯
- çŠ¶æ€æœºä¸ä¸€è‡´
- åŒå‡»+é•¿æŒ‰å¤±æ•ˆ

**ç¼“è§£æªæ–½**:
```python
# ä¿ç•™ pynput ä½œä¸º fallback
class HybridHotkeyManager:
    def __init__(self):
        self.use_native = True
        self.fallback_manager = None

    def start(self, ...):
        try:
            self.native_manager = NativeHotkeyManager(...)
            if not self.native_manager.start():
                raise RuntimeError("Native manager failed")
        except Exception as e:
            logger.warning(f"Native manager failed: {e}, using pynput fallback")
            self.use_native = False
            self.fallback_manager = PynputHotkeyManager(...)
            return self.fallback_manager.start(...)
```

**æµ‹è¯•ç­–ç•¥**:
- âœ… å•å…ƒæµ‹è¯•ï¼ˆè¦†ç›–æ‰€æœ‰çŠ¶æ€è½¬æ¢ï¼‰
- âœ… é›†æˆæµ‹è¯•ï¼ˆçœŸå®æŒ‰é”®æ¨¡æ‹Ÿï¼‰
- âœ… å‹åŠ›æµ‹è¯•ï¼ˆå¿«é€Ÿè¿ç»­æŒ‰é”®ï¼‰
- âœ… ç¨³å®šæ€§æµ‹è¯•ï¼ˆé•¿æ—¶é—´è¿è¡Œï¼‰

---

#### é£é™© 6: ç»´æŠ¤è´Ÿæ‹…

**ä¸¥é‡æ€§**: ğŸŸ¡ ä¸­
**æ¦‚ç‡**: é«˜

**é•¿æœŸç»´æŠ¤è€ƒè™‘**:

| ç»´æŠ¤ä»»åŠ¡ | pynput | PyObjC åŸç”Ÿ |
|---------|--------|------------|
| ä¾èµ–æ›´æ–° | ä¾èµ–ä¸Šæ¸¸ | è‡ªå·±ç»´æŠ¤ |
| Bug ä¿®å¤ | ç­‰å¾…ä¸Šæ¸¸ | ç«‹å³ä¿®å¤ |
| æ–°ç‰¹æ€§ | è¯·æ±‚ä¸Šæ¸¸ | è‡ªç”±æ·»åŠ  |
| æ–‡æ¡£ | è‹±æ–‡ï¼ˆç¤¾åŒºï¼‰ | ä¸­æ–‡ï¼ˆè‡ªç»´æŠ¤ï¼‰ |

**å‡€æ”¶ç›Šåˆ†æ**:
- è´Ÿæ‹…: éœ€è¦è‡ªå·±ç»´æŠ¤åº•å±‚ä»£ç 
- æ”¶ç›Š: å®Œå…¨æŒæ§ï¼Œå¿«é€Ÿå“åº”é—®é¢˜
- ç»“è®º: **æ”¶ç›Š > è´Ÿæ‹…**

**é™ä½ç»´æŠ¤è´Ÿæ‹…**:
1. âœ… ä»£ç é‡å‡å°‘ 60%ï¼Œç»´æŠ¤æˆæœ¬é™ä½
2. âœ… æ— è·¨å¹³å°æŠ½è±¡ï¼Œé€»è¾‘æ¸…æ™°
3. âœ… å®Œå–„çš„æ–‡æ¡£å’Œæ³¨é‡Š
4. âœ… è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–

---

## ç¬¬å››éƒ¨åˆ†ï¼šå®æ–½è®¡åˆ’

### 4.1 åˆ†é˜¶æ®µå®æ–½è·¯çº¿

```
Week 1: æ ¸å¿ƒåŠŸèƒ½å®ç°
â”œâ”€ Day 1-2: åŸºç¡€æ¶æ„æ­å»º
â”‚  â”œâ”€ NativeKeyboardListener ç±»æ¡†æ¶
â”‚  â”œâ”€ Event Tap åˆ›å»ºå’Œé”€æ¯
â”‚  â”œâ”€ Run Loop çº¿ç¨‹ç®¡ç†
â”‚  â””â”€ å•å…ƒæµ‹è¯•åŸºç¡€è®¾æ–½
â”‚
â”œâ”€ Day 3-4: äº‹ä»¶å¤„ç†å®ç°
â”‚  â”œâ”€ äº‹ä»¶å›è°ƒå‡½æ•°
â”‚  â”œâ”€ æŒ‰é”®ç è§£æ
â”‚  â”œâ”€ ä¿®é¥°é”®çŠ¶æ€è¿½è¸ª
â”‚  â””â”€ çº¿ç¨‹å®‰å…¨é˜Ÿåˆ—é€šä¿¡
â”‚
â””â”€ Day 5-7: é›†æˆå’Œæµ‹è¯•
   â”œâ”€ ä¸ HotkeyManager é›†æˆ
   â”œâ”€ çŠ¶æ€æœºé€‚é…
   â”œâ”€ åŒå‡»+é•¿æŒ‰åŠŸèƒ½
   â””â”€ åˆæ­¥æµ‹è¯•

Week 2: é«˜çº§ç‰¹æ€§å’Œä¼˜åŒ–
â”œâ”€ Day 8-10: èµ„æºç®¡ç†ä¼˜åŒ–
â”‚  â”œâ”€ æ­£ç¡®çš„ CFRelease è°ƒç”¨
â”‚  â”œâ”€ å†…å­˜æ³„æ¼æ£€æµ‹
â”‚  â””â”€ æ€§èƒ½ä¼˜åŒ–
â”‚
â”œâ”€ Day 11-12: é”™è¯¯å¤„ç†å’Œæ¢å¤
â”‚  â”œâ”€ Listener é‡å¯æœºåˆ¶
â”‚  â”œâ”€ é”™è¯¯æ£€æµ‹å’Œæ—¥å¿—
â”‚  â””â”€ Fallback åˆ° pynput
â”‚
â””â”€ Day 13-14: å…¨é¢æµ‹è¯•
   â”œâ”€ åŠŸèƒ½æµ‹è¯•
   â”œâ”€ æ€§èƒ½æµ‹è¯•
   â”œâ”€ ç¨³å®šæ€§æµ‹è¯•
   â””â”€ å…¼å®¹æ€§æµ‹è¯•

Week 3: æ–‡æ¡£å’Œå‘å¸ƒ
â”œâ”€ Day 15-16: æ–‡æ¡£ç¼–å†™
â”‚  â”œâ”€ API æ–‡æ¡£
â”‚  â”œâ”€ æ¶æ„è¯´æ˜
â”‚  â””â”€ æ•…éšœæ’æŸ¥æŒ‡å—
â”‚
â””â”€ Day 17-21: ç°åº¦å‘å¸ƒå’Œç›‘æ§
   â”œâ”€ å†…éƒ¨æµ‹è¯•
   â”œâ”€ å°èŒƒå›´è¯•ç”¨
   â”œâ”€ é—®é¢˜ä¿®å¤
   â””â”€ æ­£å¼å‘å¸ƒ
```

---

### 4.2 æŠ€æœ¯é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† | æ—¶é—´ |
|--------|--------|---------|------|
| **M1: æ ¸å¿ƒç›‘å¬** | åŸºç¡€ Listener ç±» | èƒ½æ¥æ”¶æŒ‰é”®äº‹ä»¶ | Day 3 |
| **M2: çŠ¶æ€ç®¡ç†** | HotkeyManager é€‚é… | å¿«æ·é”®åŠŸèƒ½æ­£å¸¸ | Day 7 |
| **M3: æ€§èƒ½ä¼˜åŒ–** | ä¼˜åŒ–ç‰ˆæœ¬ | æ€§èƒ½ä¼˜äº pynput | Day 10 |
| **M4: ç¨³å®šæ€§éªŒè¯** | æµ‹è¯•æŠ¥å‘Š | 24h ç¨³å®šè¿è¡Œ | Day 14 |
| **M5: ç”Ÿäº§å°±ç»ª** | å®Œæ•´å®ç° | é€šè¿‡æ‰€æœ‰æµ‹è¯• | Day 21 |

---

## ç¬¬äº”éƒ¨åˆ†ï¼šå›æ»šå’Œå…¼å®¹æ€§æ–¹æ¡ˆ

### 5.1 æ¸è¿›å¼è¿ç§»ç­–ç•¥

```python
# config/settings.py æ·»åŠ é…ç½®
{
    "hotkey": {
        "implementation": "auto",  # "auto" | "native" | "pynput"
        "fallback_enabled": true,
    }
}

# hotkey_manager.py é€‚é…å™¨
class HotkeyManagerFactory:
    @staticmethod
    def create(settings):
        impl = settings.hotkey_implementation

        if impl == "pynput":
            return PynputHotkeyManager(...)
        elif impl == "native":
            return NativeHotkeyManager(...)
        else:  # auto
            # ä¼˜å…ˆä½¿ç”¨ nativeï¼Œå¤±è´¥åˆ™ fallback
            try:
                manager = NativeHotkeyManager(...)
                if manager.start():
                    logger.info("âœ“ ä½¿ç”¨ PyObjC åŸç”Ÿå®ç°")
                    return manager
            except Exception as e:
                logger.warning(f"Native å®ç°å¤±è´¥: {e}ï¼Œå›é€€åˆ° pynput")

            # Fallback to pynput
            logger.info("ä½¿ç”¨ pynput å®ç°")
            return PynputHotkeyManager(...)
```

---

### 5.2 ç°åº¦å‘å¸ƒè®¡åˆ’

**é˜¶æ®µ 1: å†…éƒ¨æµ‹è¯•** (Day 15-16)
- å¼€å‘å›¢é˜Ÿä½¿ç”¨
- æ”¶é›†åˆæ­¥åé¦ˆ
- ä¿®å¤å…³é”® bug

**é˜¶æ®µ 2: Beta æµ‹è¯•** (Day 17-18)
- 10% ç”¨æˆ·å¯ç”¨
- ç›‘æ§é”™è¯¯ç‡
- æ€§èƒ½å¯¹æ¯”

**é˜¶æ®µ 3: é€æ­¥æ¨å¹¿** (Day 19-21)
- 50% ç”¨æˆ·å¯ç”¨
- éªŒè¯ç¨³å®šæ€§
- å‡†å¤‡å…¨é‡å‘å¸ƒ

**é˜¶æ®µ 4: å…¨é‡å‘å¸ƒ** (Day 21+)
- æ‰€æœ‰ç”¨æˆ·å¯ç”¨
- ä¿ç•™ pynput 1-2 ç‰ˆæœ¬ä½œä¸ºç´§æ€¥ fallback

---

### 5.3 ç´§æ€¥å›æ»šæœºåˆ¶

```python
# æ£€æµ‹åˆ°ä¸¥é‡é—®é¢˜æ—¶è‡ªåŠ¨å›æ»š
class HealthMonitor:
    def __init__(self):
        self.error_count = 0
        self.threshold = 10  # 10æ¬¡é”™è¯¯åå›æ»š

    def report_error(self, error):
        self.error_count += 1
        if self.error_count >= self.threshold:
            logger.error("é”™è¯¯ç‡è¿‡é«˜ï¼Œè§¦å‘å›æ»š")
            self.trigger_rollback()

    def trigger_rollback(self):
        # ä¿å­˜å½“å‰è®¾ç½®
        settings = get_settings()
        settings.hotkey_implementation = "pynput"
        settings.save()

        # é‡å¯åº”ç”¨
        restart_application()
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šæˆåŠŸæŒ‡æ ‡

### 6.1 æŠ€æœ¯æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰ (pynput) | ç›®æ ‡ (PyObjC) | æ£€éªŒæ–¹æ³• |
|------|--------------|--------------|---------|
| **å¯åŠ¨é€Ÿåº¦** | 508ms | <100ms | è‡ªåŠ¨åŒ–æµ‹è¯• |
| **äº‹ä»¶å»¶è¿Ÿ** | P99: 5.2ms | <3ms | æ€§èƒ½åŸºå‡† |
| **å†…å­˜å ç”¨** | 8-12MB | <5MB | å†…å­˜ç›‘æ§ |
| **å´©æºƒç‡** | 1/100é‡å¯ | 0 | ç¨³å®šæ€§æµ‹è¯• |
| **èµ„æºæ³„æ¼** | 15MB/24h | 0 | é•¿æœŸè¿è¡Œ |

---

### 6.2 ç”¨æˆ·ä½“éªŒæŒ‡æ ‡

| æŒ‡æ ‡ | æ”¹è¿›ç›®æ ‡ | æµ‹é‡æ–¹æ³• |
|------|---------|---------|
| **å“åº”é€Ÿåº¦** | "æŒ‰é”®æ— å»¶è¿Ÿ" | ç”¨æˆ·åé¦ˆ |
| **ç¨³å®šæ€§** | "ä»ä¸å´©æºƒ" | é”™è¯¯æŠ¥å‘Š |
| **èµ„æºå ç”¨** | "ä¸å¡é¡¿" | ç³»ç»Ÿç›‘æ§ |

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæŠ€æœ¯æ”¯æŒå‡†å¤‡

### 7.1 å¼€å‘å·¥å…·é“¾

**å¿…éœ€å·¥å…·**:
```bash
# PyObjC
pip install pyobjc-framework-Quartz
pip install pyobjc-framework-ApplicationServices
pip install pyobjc-framework-CoreFoundation

# å¼€å‘å·¥å…·
pip install pytest          # å•å…ƒæµ‹è¯•
pip install pytest-benchmark # æ€§èƒ½æµ‹è¯•
pip install memory_profiler # å†…å­˜åˆ†æ
pip install py-spy          # æ€§èƒ½åˆ†æ
```

**è°ƒè¯•å·¥å…·**:
- Instruments (macOS æ€§èƒ½åˆ†æ)
- LLDB (åº•å±‚è°ƒè¯•)
- Console.app (ç³»ç»Ÿæ—¥å¿—)

---

### 7.2 ç›‘æ§å’Œæ—¥å¿—

**ç»“æ„åŒ–æ—¥å¿—**:
```python
import structlog

logger = structlog.get_logger()

# äº‹ä»¶æ—¥å¿—
logger.info("key_event",
    key="left_alt",
    action="press",
    latency_ms=0.5,
    thread_id=threading.get_ident(),
)

# æ€§èƒ½æ—¥å¿—
logger.info("performance",
    startup_time_ms=63,
    event_p50_ms=0.5,
    event_p99_ms=2.1,
    memory_mb=3.2,
)

# é”™è¯¯æ—¥å¿—
logger.error("listener_error",
    error="Event tap creation failed",
    errno=123,
    traceback=...,
)
```

**ç›‘æ§æŒ‡æ ‡**:
```python
class ListenerMetrics:
    def __init__(self):
        self.counters = {
            'events_processed': 0,
            'events_dropped': 0,
            'errors': 0,
            'restarts': 0,
        }
        self.gauges = {
            'memory_mb': 0,
            'cpu_percent': 0,
            'event_latency_p50_ms': 0,
            'event_latency_p99_ms': 0,
        }

    def report(self):
        return {
            'counters': self.counters,
            'gauges': self.gauges,
        }
```

---

### 7.3 æ•…éšœæ’æŸ¥æŒ‡å—

**é—®é¢˜è¯Šæ–­æ ‘**:

```
æŒ‰é”®æ— å“åº”
â”œâ”€ æ£€æŸ¥æƒé™: AXIsProcessTrusted()
â”œâ”€ æ£€æŸ¥ Listener: is_alive()
â”œâ”€ æ£€æŸ¥ Event Tap: CGEventTapIsEnabled()
â””â”€ æ£€æŸ¥çº¿ç¨‹: _event_thread.is_alive()

åº”ç”¨å´©æºƒ
â”œâ”€ æ£€æŸ¥ Crash Report
â”œâ”€ æ£€æŸ¥ TSM çº¿ç¨‹é—®é¢˜
â””â”€ æ£€æŸ¥å†…å­˜è®¿é—®é”™è¯¯

æ€§èƒ½ä¸‹é™
â”œâ”€ æ£€æŸ¥äº‹ä»¶å»¶è¿Ÿ
â”œâ”€ æ£€æŸ¥ CPU å ç”¨
â””â”€ æ£€æŸ¥å†…å­˜æ³„æ¼
```

---

## ç¬¬å…«éƒ¨åˆ†ï¼šç»“è®ºå’Œå»ºè®®

### 8.1 ç»¼åˆè¯„ä¼°

| è¯„ä¼°ç»´åº¦ | è¯„åˆ† (1-5) | è¯´æ˜ |
|---------|-----------|------|
| **æŠ€æœ¯å¯è¡Œæ€§** | 5/5 | API æˆç†Ÿï¼Œæ–‡æ¡£å®Œå–„ |
| **æ€§èƒ½æå‡** | 5/5 | å¯åŠ¨å¿« 87%ï¼Œå†…å­˜å°‘ 60% |
| **ç¨³å®šæ€§æ”¹è¿›** | 5/5 | å½»åº•è§£å†³ TSM é—®é¢˜ |
| **å®ç°å¤æ‚åº¦** | 3/5 | éœ€è¦åº•å±‚çŸ¥è¯†ï¼Œä½†å¯æ§ |
| **ç»´æŠ¤æˆæœ¬** | 4/5 | ä»£ç å°‘ï¼Œä½†éœ€è‡ªç»´æŠ¤ |
| **é£é™©æ§åˆ¶** | 4/5 | æœ‰ fallback å’Œå›æ»šæœºåˆ¶ |
| **ç”¨æˆ·ä»·å€¼** | 5/5 | å“åº”æ›´å¿«ï¼Œæ›´ç¨³å®š |

**æ€»åˆ†**: 31/35 (**88%**)

---

### 8.2 æœ€ç»ˆå»ºè®®

**âœ… å¼ºçƒˆæ¨èé‡‡ç”¨ PyObjC åŸç”Ÿå®ç°**

**æ ¸å¿ƒç†ç”±**:
1. ğŸš€ **æ€§èƒ½æå‡æ˜¾è‘—**: å¯åŠ¨å¿« 87%ï¼Œå†…å­˜å°‘ 60%
2. ğŸ›¡ï¸ **ç¨³å®šæ€§æ ¹æœ¬æ”¹å–„**: å½»åº•è§£å†³ TSM çº¿ç¨‹å®‰å…¨é—®é¢˜
3. ğŸ”§ **å®Œå…¨æŒæ§**: æ— å¤–éƒ¨ä¾èµ–é£é™©ï¼Œæ˜“äºè°ƒè¯•å’Œä¼˜åŒ–
4. ğŸ“¦ **ä»£ç ç®€åŒ–**: å‡å°‘ 70% ä»£ç é‡ï¼Œé™ä½ç»´æŠ¤æˆæœ¬
5. ğŸ¯ **ç”¨æˆ·ä»·å€¼**: å“åº”æ›´å¿«ï¼Œä½“éªŒæ›´æµç•…

**é£é™©å¯æ§**:
- å®æ–½å‘¨æœŸçŸ­: 2-3 å‘¨
- æŠ€æœ¯é£é™©ä½: API æˆç†Ÿï¼Œæœ‰å‚è€ƒå®ç°
- æœ‰ fallback: pynput å¯ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ

**å»ºè®®å®æ–½é¡ºåº**:
1. Week 1: æ ¸å¿ƒåŠŸèƒ½å¼€å‘
2. Week 2: æµ‹è¯•å’Œä¼˜åŒ–
3. Week 3: ç°åº¦å‘å¸ƒ

---

### 8.3 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**ç«‹å³è¡ŒåŠ¨**:
1. âœ… åˆ›å»º feature åˆ†æ”¯
2. âœ… æ­å»ºå¼€å‘ç¯å¢ƒ
3. âœ… ç¼–å†™ç¬¬ä¸€ä¸ª prototype

**éœ€è¦å†³ç­–**:
1. æ˜¯å¦æ‰¹å‡† 2-3 å‘¨çš„å¼€å‘å‘¨æœŸï¼Ÿ
2. æ˜¯å¦ä¿ç•™ pynput ä½œä¸º fallbackï¼Ÿ
3. ç°åº¦å‘å¸ƒç­–ç•¥æ˜¯å¦å¯è¡Œï¼Ÿ

---

## é™„å½•

### A. å‚è€ƒæ–‡æ¡£

- [PyObjC Documentation](https://pyobjc.readthedocs.io/)
- [Quartz Event Tap Reference](https://developer.apple.com/documentation/quartz/1450564-cgeventtapcreate)
- [Carbon Text Services Manager](https://developer.apple.com/documentation/carbon)

### B. æµ‹è¯•ç”¨ä¾‹

```python
# tests/test_native_listener.py
def test_listener_creation():
    """æµ‹è¯• Listener åˆ›å»º"""
    listener = NativeKeyboardListener(on_press=lambda k: None)
    assert listener is not None

def test_event_tap_creation():
    """æµ‹è¯• Event Tap åˆ›å»º"""
    listener = NativeKeyboardListener(...)
    assert listener._tap is not None

def test_keycode_context():
    """æµ‹è¯•é”®ç›˜ä¸Šä¸‹æ–‡åŠ è½½"""
    context = load_keycode_context()
    assert context is not None
    assert context.keyboard_type is not None

def test_event_dispatch():
    """æµ‹è¯•äº‹ä»¶åˆ†å‘"""
    events = []
    listener = NativeKeyboardListener(
        on_press=lambda k: events.append(('press', k)),
        on_release=lambda k: events.append(('release', k))
    )
    # æ¨¡æ‹Ÿäº‹ä»¶
    # ...
    assert len(events) > 0
```

### C. æ€§èƒ½åŸºå‡†è„šæœ¬

```python
# benchmarks/listener_benchmark.py
def benchmark_startup_time():
    """åŸºå‡†æµ‹è¯•ï¼šå¯åŠ¨æ—¶é—´"""
    iterations = 100
    times = []

    for _ in range(iterations):
        start = time.perf_counter()
        listener = NativeKeyboardListener(...)
        listener.start()
        end = time.perf_counter()
        times.append((end - start) * 1000)
        listener.stop()

    print(f"P50: {np.percentile(times, 50):.2f}ms")
    print(f"P99: {np.percentile(times, 99):.2f}ms")

def benchmark_event_latency():
    """åŸºå‡†æµ‹è¯•ï¼šäº‹ä»¶å»¶è¿Ÿ"""
    # ...
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-07
**ä½œè€…**: Claude (Technical Research)
**å®¡æ ¸**: å¾…å®¡æ ¸
